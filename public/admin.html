<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Treasure Hunt</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="card admin-wide">
        <h1>Control Tower</h1>
        <h2 id="statusDisplay">Status: Loading...</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
            <button onclick="setState('PLAYING')" style="background: #4caf50;">‚ñ∂ RESUME GAME</button>
            <button onclick="setState('BREAK')" style="background: #2196f3;">‚è∏ SET BREAK</button>
            <button onclick="setState('FINISHED')" style="background: #f44336;">üèÅ END GAME</button>
            <button onclick="restartGame()" style="background: #000; color: white;">üîÅ HARD RESET</button>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            <label>Target Question ID (0, 1, 2...):</label>
            <input id="qIdx" type="number" value="0">
            <button onclick="revealClue()">REVEAL NEXT CLUE FOR THIS QUESTION</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Rank</th><th>Team Name</th><th>Current Q</th><th>Status</th></tr>
                </thead>
                <tbody id="playerTable"></tbody>
            </table>
        </div>
        
        <button onclick="window.open('/export')" style="margin-top: 20px; background: #673ab7; color: white;">üì• DOWNLOAD CSV RESULTS</button>
    </div>
    <div class="table-container">
    <h3>Question & Clue Status</h3>
    <table>
        <thead>
            <tr>
                <th>Q#</th>
                <th>Question Preview</th>
                <th>Clues Revealed</th>
            </tr>
        </thead>
        <tbody id="clueStatusTable"></tbody>
    </table>
</div>

    <script>
        function setState(state) {
            fetch("/state", { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify({state}) });
        }

        function revealClue() {
            const qIndex = document.getElementById("qIdx").value;
            fetch("/reveal", { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify({qIndex}) });
        }

        function restartGame() {
            if(confirm("DANGER: This will wipe all player progress. Continue?")) {
                fetch("/restart", {method:"POST"});
            }
        }

        function updateAdmin() {
    // ... your existing code for statusDisplay and playerTable ...

    fetch("/admin/status").then(r => r.json()).then(s => {
        document.getElementById("statusDisplay").innerText = `Status: ${s.gameState}`;
        
        // Populate the Question/Clue Table
        const clueTable = document.getElementById("clueStatusTable");
        let clueHtml = "";
        
        // Loop through total questions based on server data
        for (let i = 0; i < s.totalQuestions; i++) {
            const revealed = s.clueCount[i] || 0;
            clueHtml += `
                <tr>
                    <td>Question ${i + 1}</td>
                    <td>(Index ${i})</td>
                    <td>
                        <span style="color: ${revealed > 0 ? '#ff9800' : '#555'}">
                            ${"üí°".repeat(revealed)}${"‚ö™".repeat(3 - revealed)}
                        </span> 
                        (${revealed}/3)
                    </td>
                </tr>
            `;
        }
        clueTable.innerHTML = clueHtml;
    });
}
    </script>
</body>
</html>